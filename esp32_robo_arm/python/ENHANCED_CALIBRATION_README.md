# Enhanced Motor Calibration with API Storage

–£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ –º–æ—Ç–æ—Ä–æ–≤ —Ä–æ–±–æ—Ç–∞-—Ä—É–∫–∏ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ API –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### ‚úÖ **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–µ–∂–∏–º—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è**
- **API —Ç–æ–ª—å–∫–æ** - –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- **–§–∞–π–ª —Ç–æ–ª—å–∫–æ** - –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
- **–ì–∏–±—Ä–∏–¥–Ω—ã–π** - –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –∏ –ª–æ–∫–∞–ª—å–Ω–æ

### ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**
- –ó–∞–≥—Ä—É–∑–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Å–ª—É—á–∞–µ —Å–±–æ—è API

### ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞
- –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API
- –°—Ç–∞—Ç—É—Å –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## üìÅ –§–∞–π–ª—ã —Å–∏—Å—Ç–µ–º—ã

```
python/
‚îú‚îÄ‚îÄ enhanced_calibrate.py          # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ —Å API
‚îú‚îÄ‚îÄ quick_calibrate.py             # –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏
‚îú‚îÄ‚îÄ test_calibration_api.py       # –¢–µ—Å—Ç API –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
‚îî‚îÄ‚îÄ classes/
    ‚îî‚îÄ‚îÄ data_storage_manager.py    # –ú–µ–Ω–µ–¥–∂–µ—Ä —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
```

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
```bash
cd python/server
python3 data_server.py
```

### 2. –ó–∞–ø—É—Å–∫ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏

#### **–ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç API:**
```bash
python3 test_calibration_api.py
```

#### **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞:**
```bash
python3 enhanced_calibrate.py
```

#### **–ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫:**
```bash
python3 quick_calibrate.py
```

## üéØ –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

### **1. API Only (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
```python
calibrator = EnhancedMotorCalibrator(
    robot_id="esp32_robot_arm_001",
    server_url="http://localhost:8000/api",
    use_api=True,
    fallback_to_file=False
)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∫–∞–ª–∏–±—Ä–æ–≤–æ–∫
- ‚úÖ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### **2. File Only (–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)**
```python
calibrator = EnhancedMotorCalibrator(
    use_api=False,
    fallback_to_file=True
)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º –∫–æ–¥–æ–º
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø

### **3. Hybrid (–õ—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç)**
```python
calibrator = EnhancedMotorCalibrator(
    robot_id="esp32_robot_arm_001",
    server_url="http://localhost:8000/api",
    use_api=True,
    fallback_to_file=True
)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω –∏ –æ–Ω–ª–∞–π–Ω
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É

## üîß –ü—Ä–æ—Ü–µ—Å—Å –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏

### **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞:**

1. **–í—ã–±–æ—Ä —Ä–æ–±–æ—Ç–∞** - –≤–≤–µ–¥–∏—Ç–µ ID —Ä–æ–±–æ—Ç–∞
2. **–í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è** - API/—Ñ–∞–π–ª/–≥–∏–±—Ä–∏–¥–Ω—ã–π
3. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ESP32** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
4. **–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö** - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏
5. **–í—ã–±–æ—Ä –º–æ—Ç–æ—Ä–∞** - –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ –≤—Å–µ—Ö –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ
6. **–ü—Ä–æ—Ü–µ—Å—Å –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏:**
   - –î–≤–∏–∂–µ–Ω–∏–µ –∫ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ (forward)
   - –î–≤–∏–∂–µ–Ω–∏–µ –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ (backward)  
   - –í–æ–∑–≤—Ä–∞—Ç –∫ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ (return)
7. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** - –≤ API –∏/–∏–ª–∏ —Ñ–∞–π–ª

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞:**
```python
# –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –≤—Å–µ—Ö –º–æ—Ç–æ—Ä–æ–≤
await calibrator.calibrate_all_motors(speed=150)

# –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –æ–¥–Ω–æ–≥–æ –º–æ—Ç–æ—Ä–∞
await calibrator.calibrate_motor(motor=0, speed=150)
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏

### **–í API (MotorCalibrationData):**
```json
{
  "motor_id": 0,
  "calibrated": true,
  "calibration_date": "2025-01-14T12:00:00",
  "forward_time": 9.2,
  "backward_time": 14.4,
  "speed": 150,
  "min_position": null,
  "max_position": null,
  "return_time": 3.8,
  "total_travel_time": 23.6,
  "average_travel_time": 11.8
}
```

### **–í —Ñ–∞–π–ª–µ (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å):**
```json
{
  "0": {
    "calibrated": true,
    "calibration_date": "2025-01-14T12:00:00",
    "forward_time": 9.2,
    "backward_time": 14.4,
    "speed": 150,
    "positions": {
      "min": null,
      "max": null
    },
    "return_time": 3.8,
    "total_travel_time": 23.6,
    "average_travel_time": 11.8
  }
}
```

## üåê API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏

### **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏:**
```bash
curl -X POST http://localhost:8000/api/calibration \
  -H "Content-Type: application/json" \
  -d '{
    "robot_id": "esp32_robot_arm_001",
    "calibration_data": {
      "0": {
        "motor_id": 0,
        "calibrated": true,
        "calibration_date": "2025-01-14T12:00:00",
        "forward_time": 9.2,
        "backward_time": 14.4,
        "speed": 150
      }
    }
  }'
```

### **–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏:**
```bash
curl http://localhost:8000/api/calibration/esp32_robot_arm_001
```

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º—ã

### **–°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±:**
```python
from classes.motor_calibration import MotorCalibrator

calibrator = MotorCalibrator()
await calibrator.interactive_calibration()
```

### **–ù–æ–≤—ã–π —Å–ø–æ—Å–æ–±:**
```python
from enhanced_calibrate import EnhancedMotorCalibrator

calibrator = EnhancedMotorCalibrator(
    robot_id="esp32_robot_arm_001",
    use_api=True,
    fallback_to_file=True
)
await calibrator.interactive_calibration()
```

**–í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π!**

## üêõ –û—Ç–ª–∞–¥–∫–∞

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ API:**
```python
calibrator = EnhancedMotorCalibrator()
await calibrator.test_api_connection()
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**
```python
await calibrator.load_calibration_data()
calibrator.show_calibration_status()
```

### **–õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:**
```bash
# –ó–∞–ø—É—Å–∫ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ –ª–æ–≥–∞–º–∏
uvicorn data_server:app --host 0.0.0.0 --port 8000 --log-level debug
```

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

### **–ü–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å–æ —Å—Ç–∞—Ä–æ–π —Å–∏—Å—Ç–µ–º–æ–π:**

| –§—É–Ω–∫—Ü–∏—è | –°—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞ | –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ |
|---------|----------------|---------------|
| –•—Ä–∞–Ω–µ–Ω–∏–µ | –¢–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã | API + —Ñ–∞–π–ª—ã + –ë–î |
| –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è | –ù–µ—Ç | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è |
| –ò—Å—Ç–æ—Ä–∏—è | –ù–µ—Ç | –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è |
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ | –ù–µ—Ç | –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å |
| –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ | –ù–µ—Ç | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ |
| –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è | –í—ã—Å–æ–∫–∞—è |

### **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

1. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –¥–∞–Ω–Ω—ã–µ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ —Å–±–æ—è—Ö
2. **–°–æ–≤–º–µ—Å—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞** - –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–µ–ª–æ–≤–µ–∫ –º–æ–≥—É—Ç –∫–∞–ª–∏–±—Ä–æ–≤–∞—Ç—å
3. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–ª–∏–±—Ä–æ–≤–æ–∫ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
4. **–£–¥–∞–ª–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** - –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
5. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CI/CD —Å–∏—Å—Ç–µ–º–∞–º–∏

## üöÄ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### **–ë—ã—Å—Ç—Ä–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ –æ–¥–Ω–æ–≥–æ –º–æ—Ç–æ—Ä–∞:**
```python
calibrator = EnhancedMotorCalibrator(use_api=True)
await calibrator.connect()
await calibrator.calibrate_motor(0, speed=150)
await calibrator.save_calibration_data()
await calibrator.disconnect()
```

### **–ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π API:**
```python
calibrator = EnhancedMotorCalibrator()

# –ü—Ä–æ–≤–µ—Ä—è–µ–º API
if await calibrator.test_api_connection():
    calibrator.use_api = True
    print("Using API storage")
else:
    calibrator.use_api = False
    print("Using file storage")

await calibrator.interactive_calibration()
```

### **–ü—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞:**
```python
calibrator = EnhancedMotorCalibrator(robot_id="robot_001")

await calibrator.connect()
await calibrator.load_calibration_data()

# –ö–∞–ª–∏–±—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–æ—Ç–∫–∞–ª–∏–±—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ—Ç–æ—Ä—ã
for motor in range(3):
    if not calibrator.calibration_data.get(motor, {}).get("calibrated"):
        await calibrator.calibrate_motor(motor, speed=150)

await calibrator.save_calibration_data()
await calibrator.disconnect()
```

---

**–¢–µ–ø–µ—Ä—å –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ –º–æ—Ç–æ—Ä–æ–≤ —Å—Ç–∞–ª–∞ –Ω–∞–º–Ω–æ–≥–æ –Ω–∞–¥–µ–∂–Ω–µ–µ –∏ —É–¥–æ–±–Ω–µ–µ! ü§ñ‚ú®**
