# ESP32 Robot Arm Project

Проект для управления робо-рукой с тремя сервоприводами через драйвер TB6612FNG с использованием ESP32 и Bluetooth Low Energy.

## Структура проекта

```
esp32_robo_arm/
├── platformio.ini              # Конфигурация PlatformIO
├── src/
│   └── main.cpp                # Основной код программы с BLE
├── robot_arm_controller.py     # Python скрипт для управления с Mac
├── requirements.txt            # Python зависимости
└── README.md                   # Этот файл
```

## Подключение

### TB6612FNG к ESP32:

- **PWMA** → GPIO 18 (M1_PWM)
- **AIN1** → GPIO 16 (M1_IN1)
- **AIN2** → GPIO 17 (M1_IN2)
- **PWMB** → GPIO 19 (M2_PWM)
- **BIN1** → GPIO 21 (M2_IN1)
- **BIN2** → GPIO 22 (M2_IN2)
- **PWMC** → GPIO 23 (M3_PWM)
- **CIN1** → GPIO 25 (M3_IN1)
- **CIN2** → GPIO 26 (M3_IN2)
- **STBY** → GPIO 27 (STBY)

## Функциональность

Программа управляет тремя сервоприводами робо-руки через Bluetooth Low Energy:

1. **M1** - сервопривод основания (базовый поворот)
2. **M2** - сервопривод плеча (подъем/опускание)
3. **M3** - сервопривод предплечья (сгибание/разгибание)

### Логика работы:

- **BLE сервер** создает точку доступа "ESP32-RobotArm"
- **JSON команды** принимаются через BLE характеристику
- **Индивидуальное управление** каждым мотором независимо
- **Направление и скорость** задаются для каждого мотора отдельно
- **Автоматическая остановка** всех моторов при отключении BLE
- Используется PWM частота 20 кГц для плавной работы сервоприводов

### Формат JSON команд:

```json
{
  "motor": 0, // 0, 1, 2 для M1, M2, M3
  "direction": "forward", // "forward" или "backward"
  "speed": 150 // 0-255
}
```

## Сборка и загрузка

### Через PlatformIO:

```bash
# Сборка проекта
pio run

# Загрузка на ESP32
pio run --target upload

# Мониторинг серийного порта
pio device monitor
```

### Через Arduino IDE:

Просто откройте файл `src/main.cpp` в Arduino IDE и загрузите на ESP32.

## Управление через Python скрипт

### Установка зависимостей:

```bash
# Создание виртуального окружения (рекомендуется для macOS)
python3 -m venv venv

# Активация виртуального окружения
source venv/bin/activate

# Установка Python библиотеки для BLE
python -m pip install bleak
```

### Использование:

```bash
# Активация виртуального окружения (если еще не активировано)
source venv/bin/activate

# Поиск устройства ESP32
python robot_arm_controller.py scan

# Подключение и интерактивный режим
python robot_arm_controller.py connect

# Демонстрационная последовательность
python robot_arm_controller.py demo
```

### Интерактивные команды:

После подключения доступны следующие команды:

- `m <motor> <direction> <speed>` - Управление мотором
  - `motor`: 0, 1, 2 (M1, M2, M3)
  - `direction`: forward, backward
  - `speed`: 0-255
- `stop` - Остановить все моторы
- `help` - Показать справку
- `quit` - Выход

### Примеры команд:

```bash
# M1 вперед со скоростью 150
m 0 forward 150

# M2 назад со скоростью 100
m 1 backward 100

# M3 вперед на максимальной скорости
m 2 forward 255

# Остановить все моторы
stop
```

## Требования

### Аппаратные:

- ESP32 Dev Module
- TB6612FNG Motor Driver
- 3 сервопривода для робо-руки
- Блок питания для сервоприводов
- Соединительные провода

### Программные:

- PlatformIO или Arduino IDE
- Python 3.7+ (для управления с Mac)
- Библиотека `bleak` для Python

## Примечания

- Проект использует ESP32 Arduino framework 3.x
- PWM настроен на частоту 20 кГц для плавной работы сервоприводов
- Все комментарии в коде на английском языке согласно требованиям
- BLE сервер автоматически переподключается при отключении клиента
- JSON команды валидируются на ESP32 перед выполнением
- Автоматическая остановка всех моторов при потере BLE соединения
